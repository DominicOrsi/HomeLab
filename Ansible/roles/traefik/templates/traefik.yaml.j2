global:
  checkNewVersion: true
  sendAnonymousUsage: true

api:
  dashboard: true
  insecure: false
  debug: false
  disableDashboardAd: true

accesslog:
  addInternals: true
  filePath: "/var/log/traefik/traefik-access.log"
  bufferingSize: 128

log:
  filePath: "/var/log/traefik/traefik.log"
  level: INFO

metrics:
  addInternals: true

entryPoints:
  http:
    address: ":80"
    http:
      redirections:
        entryPoint:
          to: https
          scheme: https
          permanent: true
  https:
    address: ":443"
    http:
      tls:
        certResolver: cloudflare

  # --- Dynamic SSH EntryPoints ---
{% for host in groups['all'] %}
{% if hostvars[host]['ssh_proxy_port'] is defined %}
  ssh-{{ host }}:
    address: ":{{ hostvars[host]['ssh_proxy_port'] }}"
{% endif %}
{% endfor %}

providers:
  file:
    directory: /etc/traefik/dynamic
    watch: true

certificatesResolvers:
  cloudflare:
    acme:
      caServer: https://acme-v02.api.letsencrypt.org/directory
      email: {{ acme_email }}
      storage: /etc/traefik/acme.json
      dnsChallenge:
        provider: cloudflare
        resolvers:
          - "1.1.1.1:53"
          - "1.0.0.1:53"